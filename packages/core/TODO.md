# TODO 和未完成系统规划

## 概述

本文档列出了 `@cataclysm-web/core` 与 Cataclysm-DDA C++ 版本之间的功能差距，以及实现这些功能的计划。

## 完成度总览

| 系统 | 完成度 | 优先级 | 预估工作量 |
|------|--------|--------|-----------|
| 坐标系统 | ✅ 100% | - | - |
| 地形系统 | ✅ 95% | P2 | 1 周 |
| 家具系统 | ✅ 95% | P2 | 1 周 |
| 场系统 | ✅ 90% | P2 | 2 周 |
| 陷阱系统 | ✅ 90% | P2 | 1 周 |
| 生物系统 | ⚠️ 85% | P1 | 3 周 |
| 地图系统 | ✅ 90% | P1 | 2 周 |
| 地图生成 | ✅ 95% | P2 | 1 周 |
| 游戏循环 | ⚠️ 80% | P1 | 2 周 |
| 大地图系统 | ⚠️ 60% | P2 | 3 周 |
| 效果系统 | ⚠️ 40% | P0 | 3 周 |
| **物品系统** | ❌ 0% | **P0** | **4-6 周** |
| **战斗系统** | ❌ 10% | **P0** | **3-4 周** |
| 技能系统 | ⚠️ 30% | P1 | 2 周 |
| 制作系统 | ❌ 0% | P1 | 3-4 周 |
| 装备系统 | ❌ 0% | P1 | 2 周 |
| 车辆系统 | ❌ 0% | P3 | 4-6 周 |
| 天气系统 | ❌ 0% | P3 | 2-3 周 |
| NPC AI | ⚠️ 20% | P1 | 4-5 周 |
| 对话系统 | ❌ 0% | P2 | 2-3 周 |
| 任务系统 | ❌ 0% | P3 | 2-3 周 |
| 阵营系统 | ❌ 0% | P2 | 2 周 |

**优先级说明**:
- **P0**: 关键系统，游戏核心循环必需
- **P1**: 重要系统，影响游戏深度
- **P2**: 增强系统，提升游戏体验
- **P3**: 可选系统，可以后期添加

---

## 第一阶段：核心游戏循环（2-3 个月）

### P0-1: 物品系统 🔴

**状态**: 未开始
**预估工作量**: 4-6 周
**依赖**: 无

#### 子任务

- [ ] **基础结构** (1 周)
  - [ ] 定义 ItemType 接口
  - [ ] 实现 Item 类
  - [ ] 实现 ItemFactory
  - [ ] 实现 ItemLocation
  - [ ] 编写单元测试

- [ ] **物品容器** (1 周)
  - [ ] 实现 ItemPocket
  - [ ] 实现 ItemContents
  - [ ] 实现容器嵌套
  - [ ] 实现密封系统
  - [ ] 编写单元测试

- [ ] **物品栏系统** (1 周)
  - [ ] 实现 Inventory 类
  - [ ] 实现 invlet 分配
  - [ ] 实现物品查询
  - [ ] 实现容量计算
  - [ ] 编写单元测试

- [ ] **物品加载** (1 周)
  - [ ] 实现 ItemTypeLoader
  - [ ] 解析 JSON 数据
  - [ ] 处理 copy-from
  - [ ] 处理抽象对象
  - [ ] 编写集成测试

- [ ] **物品使用** (1 周)
  - [ ] 实现物品使用接口
  - [ ] 实现工具使用
  - [ ] 实现食物消耗
  - [ ] 实现弹药装填
  - [ ] 编写单元测试

- [ ] **文档和测试** (1 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖
  - [ ] 性能优化

#### 相关文件

- `src/item/Item.ts`
- `src/item/ItemType.ts`
- `src/item/ItemFactory.ts`
- `src/item/ItemLocation.ts`
- `src/item/ItemPocket.ts`
- `src/item/ItemContents.ts`
- `src/item/Inventory.ts`
- `src/item/ItemLoader.ts`

---

### P0-2: 战斗系统 🔴

**状态**: 基础框架
**预估工作量**: 3-4 周
**依赖**: 物品系统、效果系统

#### 子任务

- [ ] **伤害系统** (1 周)
  - [ ] 实现 DamageUnit
  - [ ] 实现 DamageInstance
  - [ ] 实现 Resistances
  - [ ] 实现伤害计算
  - [ ] 编写单元测试

- [ ] **近战战斗** (1 周)
  - [ ] 实现近战攻击
  - [ ] 实现命中检定
  - [ ] 实现暴击系统
  - [ ] 实现弱点打击
  - [ ] 编写单元测试

- [ ] **远程战斗** (1 周)
  - [ ] 实现抛射物系统
  - [ ] 实现弹道学
  - [ ] 实现瞄准系统
  - [ ] 实现散布计算
  - [ ] 编写单元测试

- [ ] **战斗反馈** (0.5 周)
  - [ ] 实现战斗消息
  - [ ] 实现伤害数字
  - [ ] 实现战斗日志
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/combat/DamageUnit.ts`
- `src/combat/DamageInstance.ts`
- `src/combat/Resistances.ts`
- `src/combat/MeleeCombat.ts`
- `src/combat/RangedCombat.ts`
- `src/combat/Projectile.ts`
- `src/combat/Ballistics.ts`

---

### P0-3: 效果系统 🟡

**状态**: 类型定义完成
**预估工作量**: 3 周
**依赖**: 生物系统

#### 子任务

- [ ] **效果类型** (1 周)
  - [ ] 实现 EffectType
  - [ ] 定义效果修饰符
  - [ ] 实现效果加载器
  - [ ] 编写单元测试

- [ ] **效果实例** (1 周)
  - [ ] 实现 Effect 类
  - [ ] 实现效果衰减
  - [ ] 实现效果激活
  - [ ] 实现效果叠加
  - [ ] 编写单元测试

- [ ] **效果应用** (0.5 周)
  - [ ] 实现效果应用系统
  - [ ] 处理免疫机制
  - [ ] 处理效果移除
  - [ ] 编写单元测试

- [ ] **场效果增强** (0.5 周)
  - [ ] 增强场伤害
  - [ ] 增强场扩散
  - [ ] 增强场交互
  - [ ] 编写单元测试

#### 相关文件

- `src/effect/EffectType.ts`
- `src/effect/Effect.ts`
- `src/effect/EffectSource.ts`
- `src/effect/EffectsMap.ts`
- `src/effect/EffectLoader.ts`

---

## 第二阶段：游戏深度（2-3 个月）

### P1-1: 技能系统 🟡

**状态**: 静态定义
**预估工作量**: 2 周
**依赖**: 无

#### 子任务

- [ ] **技能定义** (0.5 周)
  - [ ] 实现 Skill 类
  - [ ] 实现 SkillLevel 类
  - [ ] 实现 SkillLevelMap
  - [ ] 编写单元测试

- [ ] **技能升级** (0.5 周)
  - [ ] 实现经验系统
  - [ ] 实现升级机制
  - [ ] 实现生锈系统
  - [ ] 编写单元测试

- [ ] **技能效果** (0.5 周)
  - [ ] 实现技能检查
  - [ ] 实现技能加成
  - [ ] 实现技能训练
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/skill/Skill.ts`
- `src/skill/SkillLevel.ts`
- `src/skill/SkillLevelMap.ts`
- `src/skill/SkillLoader.ts`

---

### P1-2: 装备系统 🟡

**状态**: 未开始
**预估工作量**: 2 周
**依赖**: 物品系统、生物系统

#### 子任务

- [ ] **装备管理** (1 周)
  - [ ] 实现装备接口
  - [ ] 实现穿戴逻辑
  - [ ] 实现脱下逻辑
  - [ ] 实现装备占用
  - [ ] 编写单元测试

- [ ] **装备效果** (0.5 周)
  - [ ] 实现护甲计算
  - [ ] 实现属性加成
  - [ ] 实现特殊效果
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/equipment/Equipment.ts`
- `src/equipment/EquipmentSlot.ts`
- `src/equipment/Worn.ts`
- `src/equipment/Weapon.ts`

---

### P1-3: 制作系统 🟡

**状态**: 未开始
**预估工作量**: 3-4 周
**依赖**: 物品系统、技能系统

#### 子任务

- [ ] **配方系统** (1.5 周)
  - [ ] 实现 Recipe 类
  - [ ] 实现 RecipeLoader
  - [ ] 解析 JSON 数据
  - [ ] 编写单元测试

- [ ] **制作逻辑** (1 周)
  - [ ] 实现制作检查
  - [ ] 实现制作过程
  - [ ] 实现材料消耗
  - [ ] 实现技能要求
  - [ ] 编写单元测试

- [ ] **制作 UI** (0.5 周)
  - [ ] 实现制作列表
  - [ ] 实现配方详情
  - [ ] 实现批量制作
  - [ ] 编写单元测试

- [ ] **文档和测试** (1 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/crafting/Recipe.ts`
- `src/crafting/RecipeLoader.ts`
- `src/crafting/CraftingManager.ts`
- `src/crafting/CraftingUI.ts`

---

### P1-4: NPC AI 🟡

**状态**: 基础数据结构
**预估工作量**: 4-5 周
**依赖**: 战斗系统、技能系统

#### 子任务

- [ ] **行为树系统** (2 周)
  - [ ] 实现 BehaviorTree
  - [ ] 实现 BehaviorNode
  - [ ] 实现 Oracle
  - [ ] 实现策略模式
  - [ ] 编写单元测试

- [ ] **NPC 行为** (1.5 周)
  - [ ] 实现移动 AI
  - [ ] 实现战斗 AI
  - [ ] 实现交互 AI
  - [ ] 实现需求系统
  - [ ] 编写单元测试

- [ ] **路径规划** (0.5 周)
  - [ ] 实现 A* 寻路
  - [ ] 实现路径缓存
  - [ ] 实现障碍检测
  - [ ] 编写单元测试

#### 相关文件

- `src/ai/BehaviorTree.ts`
- `src/ai/BehaviorNode.ts`
- `src/ai/Oracle.ts`
- `src/ai/Pathfinding.ts`
- `src/ai/NPCAI.ts`

---

## 第三阶段：高级功能（2-3 个月）

### P2-1: 大地图系统 🟢

**状态**: 基础结构
**预估工作量**: 3 周
**依赖**: 地图生成系统

#### 子任务

- [ ] **Overmap 结构** (1 周)
  - [ ] 实现 Overmap 类
  - [ ] 实现 OvermapTerrain
  - [ ] 实现城市生成
  - [ ] 编写单元测试

- [ ] **Overmap 生成** (1 周)
  - [ ] 实现地形生成
  - [ ] 实现地点生成
  - [ ] 实现道路连接
  - [ ] 编写单元测试

- [ ] **Overmap 交互** (0.5 周)
  - [ ] 实现玩家移动
  - [ ] 实现区域进入
  - [ ] 实现地图缓冲
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/overmap/Overmap.ts`
- `src/overmap/OvermapTerrain.ts`
- `src/overmap/OvermapGenerator.ts`
- `src/overmap/OvermapBuffer.ts`

---

### P2-2: 对话系统 🟢

**状态**: 未开始
**预估工作量**: 2-3 周
**依赖**: NPC AI

#### 子任务

- [ ] **对话框架** (1 周)
  - [ ] 实现 Talker 接口
  - [ ] 实现 Dialogue 类
  - [ ] 实现 TalkTopic
  - [ ] 编写单元测试

- [ ] **对话逻辑** (1 周)
  - [ ] 实现对话试验
  - [ ] 实现对话效果
  - [ ] 实现对话响应
  - [ ] 编写单元测试

- [ ] **对话数据** (0.5 周)
  - [ ] 实现 TalkLoader
  - [ ] 解析对话 JSON
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/dialogue/Talker.ts`
- `src/dialogue/Dialogue.ts`
- `src/dialogue/TalkTopic.ts`
- `src/dialogue/TalkTrial.ts`
- `src/dialogue/TalkLoader.ts`

---

### P3-1: 车辆系统 🟢

**状态**: 未开始
**预估工作量**: 4-6 周
**依赖**: 物品系统、地图系统

#### 子任务

- [ ] **车辆结构** (2 周)
  - [ ] 实现 Vehicle 类
  - [ ] 实现 VehiclePart
  - [ ] 实现车辆加载
  - [ ] 编写单元测试

- [ ] **车辆物理** (1.5 周)
  - [ ] 实现车辆移动
  - [ ] 实现碰撞检测
  - [ ] 实现载重系统
  - [ ] 编写单元测试

- [ ] **车辆交互** (1 周)
  - [ ] 实现驾驶
  - [ ] 实现安装/拆卸
  - [ ] 实现加油/充电
  - [ ] 编写单元测试

- [ ] **文档和测试** (1.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/vehicle/Vehicle.ts`
- `src/vehicle/VehiclePart.ts`
- `src/vehicle/VehicleLoader.ts`
- `src/vehicle/VehiclePhysics.ts`

---

### P3-2: 天气系统 🟢

**状态**: 未开始
**预估工作量**: 2-3 周
**依赖**: 无

#### 子任务

- [ ] **天气类型** (0.5 周)
  - [ ] 定义天气类型
  - [ ] 实现 Weather 类
  - [ ] 实现天气加载
  - [ ] 编写单元测试

- [ ] **天气效果** (1 周)
  - [ ] 实现温度计算
  - [ ] 实现降水效果
  - [ ] 实现风力系统
  - [ ] 编写单元测试

- [ ] **季节系统** (0.5 周)
  - [ ] 实现日历系统
  - [ ] 实现季节变化
  - [ ] 实现天气转换
  - [ ] 编写单元测试

- [ ] **文档和测试** (1 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/weather/Weather.ts`
- `src/weather/WeatherType.ts`
- `src/weather/WeatherLoader.ts`
- `src/weather/Calendar.ts`

---

### P3-3: 任务系统 🟢

**状态**: 未开始
**预估工作量**: 2-3 周
**依赖**: NPC AI、对话系统

#### 子任务

- [ ] **任务结构** (1 周)
  - [ ] 实现 Mission 类
  - [ ] 实现 MissionLoader
  - [ ] 解析任务 JSON
  - [ ] 编写单元测试

- [ ] **任务逻辑** (1 周)
  - [ ] 实现任务分配
  - [ ] 实现任务目标
  - [ ] 实现任务奖励
  - [ ] 编写单元测试

- [ ] **任务 UI** (0.5 周)
  - [ ] 实现任务列表
  - [ ] 实现任务详情
  - [ ] 实现任务追踪
  - [ ] 编写单元测试

- [ ] **文档和测试** (0.5 周)
  - [ ] 编写 API 文档
  - [ ] 编写使用示例
  - [ ] 完善测试覆盖

#### 相关文件

- `src/mission/Mission.ts`
- `src/mission/MissionLoader.ts`
- `src/mission/MissionManager.ts`
- `src/mission/MissionUI.ts`

---

## 增强功能

### P2: 地形系统增强

- [ ] 支持更多地形标志
- [ ] 实现地形转换
- [ ] 优化地形查询性能

### P2: 家具系统增强

- [ ] 支持更多家具标志
- [ ] 实现家具损坏
- [ ] 实现家具修复

### P2: 场系统增强

- [ ] 实现场扩散算法
- [ ] 实现场融合
- [ ] 优化场更新性能

### P2: 陷阱系统增强

- [ ] 支持更多陷阱类型
- [ ] 实现陷阱制作
- [ ] 实现陷阱陷阱

### P1: 生物系统增强

- [ ] 实现身体部位详细伤害
- [ ] 实现属性计算
- [ ] 实现状态效果
- [ ] 实现装备系统

---

## 性能优化

### 内存优化

- [ ] 实现 Submap 池化
- [ ] 优化对象生命周期
- [ ] 减少不必要的拷贝

### 渲染优化

- [ ] 实现脏矩形渲染
- [ ] 优化瓦片缓存
- [ ] 实现层级渲染

### 加载优化

- [ ] 实现懒加载
- [ ] 优化 JSON 解析
- [ ] 实现资源预加载

---

## 工具和开发支持

### CLI 工具

- [ ] 数据验证工具
- [ ] 数据转换工具
- [ ] 性能分析工具
- [ ] 调试工具

### 文档

- [ ] API 参考手册 ✅
- [ ] 架构设计文档 ✅
- [ ] 贡献指南 ✅
- [ ] 部署文档 ✅
- [ ] 故障排除指南 ✅

### 测试

- [ ] 单元测试覆盖率达到 90%+
- [ ] 集成测试覆盖率达到 80%+
- [ ] 端到端测试覆盖率达到 70%+

---

## 时间线

### 2026 Q1 (1-3 月)

- ✅ 完成基础系统（已完成）
- 🔵 开始物品系统开发
- 🔵 开始效果系统开发

### 2026 Q2 (4-6 月)

- 🟢 完成物品系统
- 🟢 完成战斗系统
- 🟢 完成效果系统
- 🟢 开始技能系统

### 2026 Q3 (7-9 月)

- 🟢 完成技能系统
- 🟢 完成装备系统
- 🟢 完成制作系统
- 🟢 开始 NPC AI

### 2026 Q4 (10-12 月)

- 🟢 完成 NPC AI
- 🟢 完成大地图系统
- 🟢 完成对话系统
- 🟢 性能优化

### 2027 Q1-Q2

- 🟢 完成车辆系统
- 🟢 完成天气系统
- 🟢 完成任务系统
- 🟢 发布 v1.0

---

## 图例

- ✅ 已完成
- 🔵 进行中
- 🟢 计划中
- 🟡 部分完成
- ❌ 未开始

---

*本文档会持续更新，反映最新的开发进度和计划。*
